<script src="bower_components/cba-elements/src/manager/cba-manager.js"></script>

<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<script src="bower_components/cookies-js/dist/cookies.min.js"></script>
<script src="bower_components/crypto-js/core.js"></script>
<script src="bower_components/crypto-js/sha1.js"></script>

<link rel="import" href="bower_components/cba-elements/src/elm-header.html">
<link rel="import" href="bower_components/cba-elements/src/elm-application-behavior.html">
<link rel="import" href="bower_components/cba-elements/src/elm-footer.html">
<link rel="import" href="bower_components/cba-elements/src/elm-select.html">
<link rel="import" href="bower_components/cba-elements/src/elm-select-box.html">
<link rel="import" href="bower_components/cba-elements/src/elm-panel.html">
<link rel="import" href="bower_components/cba-elements/src/dropdown/elm-dropdown.html">

<link rel="import" href="bower_components/cba-elements/src/table/elm-table.html">
<link rel="import" href="bower_components/cba-elements/src/form/elm-file-origin.html">
<link rel="import" href="bower_components/cba-elements/src/file/elm-file-browser.html">
<link rel="import" href="bower_components/cba-elements/src/job/elm-job-browser.html">
<link rel="import" href="bower_components/cba-elements/src/elm-cluster-status.html">

<link rel="import" href="bower_components/cba-elements/src/report/elm-report.html">
<link rel="import" href="bower_components/pathway-viewer/pathway-drug-viewer.html">
<link rel="import" href="bower_components/pathway-viewer/pathway-tissue-viewer.html">

<link rel="import" href="src/hipathia-home.html">
<link rel="import" href="src/hipathia-signaling-form.html">
<link rel="import" href="src/hipathia-prediction-form.html">
<link rel="import" href="src/pathact-form.html">
<link rel="import" href="src/vafi-form.html">

<dom-module id="hipathia-element">
    <style is="custom-style" include="iron-flex iron-flex-reverse iron-flex-alignment iron-flex-factors iron-positioning"></style>
    <style>
         :host {
            display: block;
            position: relative;
            cursor: default;
            font-size: 13px;
            background-color: var(--default-primary-color);
            height: 100%;
            width: 100vmax;
        }

        elm-header {
            position: absolute;
            top: 0;
            width: 100%;
        }

        elm-footer {
            position: absolute;
            bottom: 0;
            height: 70px;
        }

        .content {
            position: absolute;
            width: 100%;
            top: 50px;
            /*height: calc(100vh - 60px);*/
            /*background-color: transparent;*/
        }

        #fileBrowserPanel {
            position: absolute;
            top: 0px;
            left: 0;
            width: 600px;
            height: 400px;
            min-width: 600px;
            min-height: 400px;
        }

        #jobBrowserPanel {
            position: absolute;
            top: 0px;
            right: 0;
            width: 600px;
            height: 400px;
            min-width: 600px;
            min-height: 400px;
        }
        #configureDrugActionsPanel {
            position: absolute;
            top: 0px;
            right: 0;
            width: 700px;
            min-width: 700px;
        }

        #fileBrowser {}

        #jobBrowser {}

        /*@media (max-width: 1100px) {
            .option-text {
                display: none;
            }
        }*/
        @media (max-width: 1720px)  {
            .option-text{
                    /*display: none;*/
                    font-size: 17px;
                }
            #headerTitle {
                font-size: 30/2px;
            }
            #description {
                font-size: 16/2px;
            }
            @media (max-width: 1674px)  {
                .option-text{
                    /*display: none;*/
                    font-size: 16px;
                }
                @media (max-width: 1650px)  {
                    .option-text{
                            /*display: none;*/
                            font-size: 15px;
                        }
                        #headerTitle {
                            font-size: 30/2px;
                        }
                        #description {
                            font-size: 16/2px;
                        }
                    @media (max-width: 1570px)  {
                        #headerTitle{
                                display: none;
                            }
                        .option-text{
                                /*display: none;*/
                                font-size: 14px;
                            }
                        @media (max-width: 1496px)  {
                            #headerTitle{
                                display: none;
                            }
                            @media (max-width: 1342px)  {
                                .option-text{
                                    /*display: none;*/
                                    font-size: 13px;
                                }
                                @media (max-width: 1294px)  {
                                    .option-text{
                                        /*display: none;*/
                                        font-size: 12px;
                                    }
                                    @media (max-width: 1229px){
                                        .option-text{
                                            /*display: none;*/
                                            font-size: 11px;
                                        }
                                        @media (max-width: 1181px)  {
                                            .option-text{
                                                /*display: none;*/
                                                font-size: 10px;
                                            }
                                            @media (max-width: 1133px)  {
                                                .option-text{
                                                    /*display: none;*/
                                                    font-size: 9px;
                                                }
                                                @media (max-width: 1087px)  {
                                                    .option-text{
                                                        display: none;
                                                    }
                                                    #headerTitle{
                                                        display: block;
                                                    }
                                                    @media (max-width: 800px)  {
                                                        #headerTitle{
                                                            display: none;
                                                        }
                                                        @media (max-width: 595px) {
                                                            #headerIcon{
                                                                display: none;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    } 
                                }
                            }
                        }
                    }
                }
            }
        }

        .userid {
            color: var(--accent-color);
            font-size: 16px;
        }

        #description {
            color: var(--accent-color);
            font-weight: normal;
            font-size: 16px;
            margin-top: 0%;
            padding-top: 0%;
            padding-bottom: 5px;
        }

        #viewer {
            height: calc(100vh - 50px);
            overflow-y: auto;
        }
        #vafiViewer {
            height: calc(100vh - 50px);
            overflow-y: auto;
        }
        #headerTitle{
            margin-left:15px;
            margin-bottom: 0px; 
            padding-bottom: 0px
        }

        hipathia-home {
            height: calc(100vh - 100px);
            overflow-y: auto;
        }

        hipathia-prediction-form,
        hipathia-signaling-form,
        pathact-form,
        vafi-form,
        elm-report{
            height: calc(100vh - 50px);
            overflow-y: auto;
        }
    </style>
    <template>
        <!-- Home page call src/hipathia-home.html -->
        <div class="content" menu-option="home">
            <hipathia-home id="home" on-start="handleHomeStart" isLogged="{{isLogged}}"></hipathia-home>
        </div>
        <!--Report page -->
        <div id="jobContent" class="content" menu-option="job">
            <elm-report id="report" hide-relaunch></elm-report>
        </div>
        <!--Report page for path act-->
        <div class="content" menu-option="viewer">
                <pathway-drug-viewer id="viewer" path="sifs4CellMaps" init-path="sifs4CellMaps_init" valid-genes-file-name="valid_hgnc_signaling_genes.txt" drug-action-list="{{drugActionList}}" drug-action-map="{{drugActionMap}}" job-update-args="{{jobUpdateArgs}}" job-clear-args="{{jobClearArgs}}" fold-change="{{foldChange}}" on-goback="handleViewerGoBack" on-job-clear="handleJobClear" on-job-update="handleJobUpdate" hideBackButton>
                    <div id="reportButton" on-click="handleReportButton" class="left-label elm-btn elm-btn-shdw" style="margin:0 3px 0 0;"><i class="fa fa-file-text-o"></i> &nbsp; Show report</div>
                </pathway-drug-viewer>
                <elm-panel hidden movable closable fixed modal id="reportPanel">
                    <div class="header">
                        Report
                    </div>
                    <div id="reportPanelContainer" class="container">
                        <elm-report id="reportP" hide-job-information></elm-report>
                    </div>
                    <div class="footer flex horizontal layout center-justified">
                        <div class="elm-btn elm-btn-shdw" style="width:250px;" on-click="handleCloseReport">Close</div>
                    </div>
                </elm-panel>
        </div>       
        <!--Report page for Vafi-->
        <div class="content" menu-option="vafiViewer">
                <!--tissues/Blood/pathways-->
                <!--<div id="mainVafiReport"></div>-->
                <pathway-tissue-viewer id="vafiViewer" path="tissues"  init-path="tissues/Blood/pathways">
                </pathway-tissue-viewer>
             <!--   <pathway-tissue-viewer  id="vafiViewer" class="container" path="tissues/Blood/pathways" path-type="session">
                    <div class="right-label ">
                        External box:
                    </div>
                    <div class="right-box" style="height:100px;"></div>
                    <div class="left-label elm-btn elm-btn-shdw">!</div>
                </pathway-tissue-viewer >-->

        </div>
        <!--Job and data browsers call cba-elements -->
        <div class="content" menu-option="home,job,signaling,prediction,pathact,VaFInter,viewer,vafiViewer">
            <elm-panel id="jobBrowserPanel" hidden collapsible movable closable on-hidden="handlePanelHidden">
                <div class="header">
                    <i class="fa fa-flask"></i>&nbsp; Browse my studies
                </div>
                <elm-job-browser id="jobBrowser" class="container flex" on-jobselect="handleJobSelect" allowed-tools="{{allowedTools}}" on-need-refresh="handleUserNeedRefresh" user-data="{{userData}}" disable-relaunch="{{disableRelaunch}}" hide-status-filter="{{hideStatusFilter}}" hide-tool-filter="{{hideToolFilter}}">
                </elm-job-browser>
            </elm-panel>
            <elm-panel id="fileBrowserPanel" hidden collapsible movable closable resizable on-hidden="handlePanelHidden">
                <div class="header">
                    <i class="fa fa-cloud"></i>&nbsp; Browse my data
                </div>
                <elm-file-browser id="fileBrowser" class="container flex" on-fileselect="handleFileSelect" bioformats="{{bioformats}}" on-need-refresh="handleUserNeedRefresh" user-data="{{userData}}">
                </elm-file-browser>
            </elm-panel>
                        <!--pathact   fixed modal -->
            <elm-panel id="configureDrugActionsPanel" hidden collapsible movable closable on-hidden="handlePanelHidden">
                <div class="header">
                    <i class="fa fa-sliders"></i> Perturbation effect settings
                </div>
                <div id="drugActionList" class="container flex" style="width:650px; padding:7px;">
                    <div class="horizontal layout">
                        <div>
                            <label class="elm">Configure fold change:</label>
                            <br>
                            <div style="width:200px">
                                <input id="foldChangeInput" class="elm" type="number" step="0.1" min="0" value="{{foldChange::input}}" on-change="handleFoldChange">
                            </div>
                        </div>
                        <div class="flex"></div>
                        <div class="elm-btn elm-btn-shdw" on-click="handleResetDefaults">Reset defaults</div>
                    </div>
                    <br>
                    <label class="elm">Configure drug action weight:</label>
                    <br>
                    <div class="list horizontal layout wrap">
                        <template is="dom-repeat" items="{{drugActionList}}">
                            <pdv-action-option style="width:315px" name="{{item.name}}" value="{{item.value}}" on-change="handleActionWeightChange"></pdv-action-option>
                        </template>
                    </div>
                </div>
            </elm-panel>
        </div>
        <!--Signaling form page call src/hipathia-signaling-form.html-->
        <div class="content" menu-option="signaling">
            <hipathia-signaling-form id="signalingForm" selectedOption="{{selectedOption}}" bioformats="{{bioformats}}" user-data="{{userData}}" on-job-launched="handleJobLaunched" ></hipathia-signaling-form>
        </div>
        <!--Precdiction form page call src/hipathia-prediction-form.html-->
        <div class="content" menu-option="prediction">
            <hipathia-prediction-form id="predictionForm" selectedOption="{{selectedOption}}" bioformats="{{bioformats}}" user-data="{{userData}}" on-job-launched="handleJobLaunched"></hipathia-prediction-form>
        </div>
        <!--pathact form page call src/hipathia-pathact-form.html-->
        <div class="content" menu-option="pathact">
            <pathact-form id="pathactForm" selectedOption="{{selectedOption}}" bioformats="{{bioformats}}" user-data="{{userData}}" on-jobselect="handleJobSelect" on-need-refresh="handleUserNeedRefresh" on-job-launched="handleJobLaunched"></pathact-form>
        </div>
        <div class="content" menu-option="VaFInter">
            <vafi-form id="vafiForm" selectedOption="{{selectedOption}}" bioformats="{{bioformats}}" user-data="{{userData}}" on-jobselect="handleJobSelect" on-need-refresh="handleUserNeedRefresh" on-job-launched="handleJobLaunched"></vafi-form>
        </div>
        
        <!-- Header call cba-elements/src/elm-header.html-->
        <elm-header id="elmHeader" hide-jobs hide-browse selected-option="{{selectedOption}}" user-data="{{userData}}" on-login="handleLogin" on-logout="handleLogout">
            <div id="headerIcon" class="icon">
                <img src="images/icon.svg" style="height: 44px;margin: 5px 3px 0 0;">
            </div>
            <!--<div class="title" style="margin-left:15px;">
                <span>hi</span><span style="font-weight:normal">P</span><span>athia</span>
            </div>
            <span id="description" class="description">
                Pathways analysis suite
            </span>-->
            <div id="headerTitle" class="title">
                <span>hi</span><span style="font-weight:normal">P</span><span>athia</span>
                
                <div id="description" class="description">
                    Pathways analysis suite
                </div>
            </div>
            <!--Menu-->
            <div id="menu" class="menu horizontal layout center flex">
                <!--left part of the menu bar-->
                <div style="margin-left:4vw;"></div>
                <div title="" class="option" on-click="handleMenuOption" data-option="home">
                    <i class="fa fa-home"></i>
                    <span class="option-text">Home</span>
                </div>
                <div style="margin-left:2vw;"></div>
                <div title="Open differential signaling form" class="option" on-click="handleMenuOption" login-required data-option="signaling">
                    <i class="fa fa fa-usb fa-flip-vertical"></i>
                    <span class="option-text">Differential signaling</span>
                </div>
                <div title="Open prediction form" class="option" on-click="handleMenuOption" login-required data-option="prediction">
                    <i class="fa fa-magic"></i>
                    <span class="option-text">Prediction</span>
                </div>
                <div title=" Actionable pathway workshop" class="option" on-click="handleMenuOption" login-required data-option="pathact">
                    <i class="fa fa-bolt"></i>
                    <span class="option-text">Perturbation effect</span>
                </div>
                <div title="Variant functional interpretation" class="option" on-click="handleMenuOption" login-required data-option="VaFInter">
                    <i class="fa fa-asterisk"></i>
                    <span class="option-text">Variant interpreter</span>
                </div>
                <!--right part of the menu bar-->
                <div class="flex" style="margin-left:2vw;"></div>
                <div title="Browse my data" class="option" on-click="handleMenuPanel" login-required login-visible data-panel="fileBrowserPanel">
                    <i class="fa fa-cloud"></i>
                    <span class="option-text">My data</span>
                </div>
                <div title="Browse my jobs"  class="option" on-click="handleMenuPanel" login-required login-visible data-panel="jobBrowserPanel">
                    <i class="fa fa-flask"></i>
                    <span class="option-text">My studies</span>
                </div>
                <!-- Options for VaF Int-->
                <div menu-option="pathact,viewer" title="Perturbation effect settings" class="option" on-click="handleMenuPanel" data-panel="configureDrugActionsPanel" login-required  pathact-visible>
                    <i class="fa fa-sliders"></i>
                    <span class="option-text">Settings</span>
                </div>
            </div>
            </div>
            <!--help icon-->
            <elm-dropdown dark class="helpmenu">
                <div data-button><i class="fa fa-question-circle"></i></div>
                <ul data-menu>
                    <a href="http://hipathia.babelomics.org/doc" target="_blank">
                        <li>
                            <i class="fa fa-book"></i> &nbsp; Documentation
                        </li>
                    </a>
                    <a href="http://hipathia.babelomics.org/doc/doku.php?id=how_to_cite_hipathia" target="_blank">
                        <li>
                            <i class="fa fa-pencil-square-o"></i> &nbsp; How to cite HiPathia
                        </li>
                    </a>
                    <li data-divider></li>
                    <li>
                        <div on-mousedown="handleExample" data-example-name="differential-signaling">
                            <i class="fa fa-lightbulb-o"></i> &nbsp; Differential signaling example
                        </div>
                    </li>
                    <li>
                        <div on-mousedown="handleExample" data-example-name="prediction-train">
                            <i class="fa fa-lightbulb-o"></i> &nbsp; Prediction train example
                        </div>
                    </li>
                    <li>
                        <div on-mousedown="handleExample" data-example-name="prediction-test">
                            <i class="fa fa-lightbulb-o"></i> &nbsp; Prediction test example
                        </div>
                    </li>
                    <li>
                        <div on-mousedown="handleExample" data-example-name="perturbation-effect">
                            <i class="fa fa-lightbulb-o"></i> &nbsp; Perturbation effect example
                        </div>
                    </li>
                    <li>
                        <div on-mousedown="handleExample" data-example-name="variant-interpreter">
                            <i class="fa fa-lightbulb-o"></i> &nbsp; Variant interpreter example
                        </div>
                    </li>
                </ul>
            </elm-dropdown>
            <elm-cluster-status id="clusterStatus" type="dark" class="cluster-status"></elm-cluster-status>
        </elm-header>
        <!--Footer call cba-elements/src/elm-footer.html -->
        <elm-footer menu-option="home,login,signup,profile,remember" class="horizontal layout center center-justified" style="padding:0 20px;">
            <div style="text-align:center;">
            hi<b>P</b>athia v<span>{{version}}</span>
            <br> Created by
            <span style="font-weight:bold;">Clinical Bioinformatics Area</span>
            <br> Fundaci√≥n Progreso y Salud (FPS), Sevilla, Spain 
            <br> 2021
            </div>
        </elm-footer>
    </template>

    <script>
        Polymer({
            is: "hipathia-element",
            behaviors: [elmApplicationBehavior],
            properties: {
                bioformats: {
                    type: Array,
                    notify: true,
                    value: [BIOFORMATS["DATAMATRIX_EXPRESSION"], BIOFORMATS["EXPERIMENTAL_DESIGN"], BIOFORMATS["GENE_LIST"]]
                },
                allowedTools: {
                    type: Array,
                    value: function() {
                        return ['hipathia.differential-signaling', 'hipathia.prediction-train', 'hipathia.prediction-test', 'hipathia.perturbation-effect', 'hipathia.variant-interpreter'];
                        //return ['hipathia.differential-signaling', 'hipathia.prediction-train', 'hipathia.prediction-test', 'hipathia.pathact-init', 'hipathia.vafi-init','utils.report'];
                    }
                },
                disableRelaunch: {
                    type: Boolean,
                    reflectToAttribute: true,
                    value: false
                },
                drugActionList: {
                    type: Array,
                    notify: true
                },
                drugActionMap: {
                    type: Object,
                    notify: true
                },
                foldChange: {
                    type: Number
                },
                jobItem: {
                    type: Object
                },
                jobUpdateArgs: {
                    type: Object
                },
                jobClearArgs: {
                    type: Object
                }
            },
            listeners: {
                'open-job-folder': 'handleOpenJobFolder'
            },
            selectedOptionChanged: function(neo, old) {
                //console.log("called from hipathia-element and neo is "+ neo); neo is selected option
                if (this.selectedOption == 'signaling' || this.selectedOption == 'prediction'  || this.selectedOption == 'VaFInter'  || this.selectedOption == 'pathact') {
                    this.$.fileBrowserPanel.hide();
                    this.$.jobBrowserPanel.hide();
                    this.$.configureDrugActionsPanel.hide();
                    if(this.selectedOption == 'VaFInter'){
                        this.$.vafiForm._loadPathwaysList("hsa","curated");
                    }else{
                        if (this.selectedOption == 'signaling' )
                            this.$.signalingForm._loadPathwaysList("hsa","metaginfo");
                        else if (this.selectedOption == 'prediction')
                            this.$.predictionForm._loadPathwaysList("hsa","metaginfo");
                    }
                    //
                }

                this.$.signalingForm._clean();
                this.$.predictionForm._clean();
                this.$.pathactForm.clean();
                this.$.vafiForm.clean();
                if(this.$.jobBrowser.querySelector("elm-job-item[selected]")!=null)
                    this.$.jobBrowser.querySelector("elm-job-item[selected]").removeAttribute("selected");
            },
            ready: function() {
                var me = this;
                this.selectedOption = "home";
                this.checkShowMenuOnLogin();
                //pathAct Start
                var fc = localStorage.getItem("pathact_foldchange");
                if (fc == null) {
                    this.set('foldChange', 2);
                    localStorage.setItem("pathact_foldchange", this.foldChange);
                } else {
                    this.set('foldChange', parseFloat(fc));
                }

                var localActions = localStorage.getItem("pathact_actions");
                if (localActions == null) {
                    this.loadDrugActions();
                } else {
                    var actions = JSON.parse(localActions);
                    var actionsMap = JSON.parse(localStorage.getItem("pathact_actionsmap"));
                    this.set('drugActionList', actions);
                    this.set('drugActionMap', actionsMap);
                }

                this.set('jobUpdateArgs', {
                    tool: 'hipathia',
                    execution: 'perturbation-effect-update',
                    executable: 'pathact-update.sh'
                });
                this.set('jobClearArgs', {
                    tool: 'hipathia',
                    execution: 'perturbation-effect-clear',
                    executable: 'pathact-clear.sh'
                });
                this.querySelectorAll("[pathact-visible]")[0].hidden = true;
                //pathAct end
               
            },
            handleOpenJobFolder: function(e) {
                var job = e.detail;
                this.$.fileBrowser.set('folder', job.folder);
                this.$.fileBrowserPanel.show();
            },
            handleFileSelect: function(e) {},
            handleJobSelect: function(e) {
                this.handleJobClearAll();
                var me = this;
                var job = e.detail;
                if (job && job.status === 'DONE') {
                    if (e.detail.execution=="perturbation-effect") {
                        var jobFolder = job.folder;
                        this.jobItem = job;
                        if (this.$.viewer.jobFolder != null) {
                            if (this.$.viewer.jobFolder._id != jobFolder._id) {
                                this.$.viewer.reset();
                                this.$.viewer.set('jobFolder', jobFolder);
                            }
                        } else {
                            this.$.viewer.reset();
                            this.$.viewer.set('jobFolder', jobFolder);
                        }
                        this.$.viewer.set('hideBackButton', true);
                        this.set('selectedOption', 'viewer');
                        this._loadReport();

                    }else{
                        if (e.detail.execution=="variant-interpreter") {
                            console.log("I am chossing : "+ e.detail.execution);
                            var jobFolder = job.folder;
                            this.jobItem = job;
                            /*if (this.$.vafiViewer.jobFolder != null) {
                                if (this.$.vafiViewer.jobFolder._id != jobFolder._id) {
                                    this.$.vafiViewer.reset();
                                    this.$.vafiViewer.set('jobFolder', jobFolder);
                                }
                            } else {*/
                                this.$.vafiViewer.reset();
                                this.$.vafiViewer.set('jobFolder', jobFolder);
                            //}

                           this.$.vafiViewer.set('showHipathiaLegend', true);
                           this.$.vafiViewer.set('hideAltered', true);
                           this.$.vafiViewer.set('path',"tissues")
                           this.set('selectedOption', 'vafiViewer');
                           this._loadVafiReport();

                        }else{
                            this.set('selectedOption', 'job');
                            this.$.report.hideJobInformation = true;
                            this.$.report.set('job', job);   
                        }

                    }
                }
            },
            handleJobLaunched: function() {
                this.setMenu('home');
                this.$.jobBrowserPanel.show();
                this.$.elmHeader.getUserInfo(true);
            },
            handleLogin: function() {
                if (Cookies('bioinfo_user').indexOf("anonymous___") != -1) {
                    this.setMenu('signaling');
                } else {
                    this.selectedOption = "home";
                }
                if (this._lastLogedRequest) {
                    this._lastLogedRequest = null;
                }
                if (this._lastExampleRequest) {
                    this.runExample(this._lastExampleRequest);
                    this._lastExampleRequest = null;
                }
                this.$.home.isLogged = true;
                this.checkShowMenuOnLogin();
            },
            handleLogout: function() {
                this.$.home.isLogged = false;
                this.setMenu('home');
                this.checkShowMenuOnLogin();
            },
            handleUserNeedRefresh: function() {
                this.$.elmHeader.getUserInfo(true);

            },
            handleHomeStart: function() {
                if (this.$.elmHeader.isLogged != true) {
                    this.$.elmHeader.anonymousSign();
                }
            },
            handleViewerGoBack: function() {
                this.setMenu('home');
            },
            handleExample: function(e) {
                if (this.$.elmHeader.isLogged != true) {
                    this._lastExampleRequest = e.currentTarget.dataset['exampleName'];
                    this.$.elmHeader.anonymousSign();
                } else {
                    this.runExample(e.currentTarget.dataset['exampleName']);
                    this.$.jobBrowserPanel.show();
                }
            },
            runExample: function(exname) {
                /*if (exname === 'differential-signaling') {
                    this.$.signalingForm.runExample();
                }
                if (exname === 'prediction-train') {
                    this.$.predictionForm.runTrainExample();
                }
                if (exname === 'prediction-test') {
                    this.$.predictionForm.runTestExample();
                }
                if (exname === 'perturbation-effect') {
                    this.$.pathactForm.handleLoadExample();
                }
                if (exname === 'variant-interpreter') {
                    this.$.vafiForm.handleLoadExample();
                }*/
                var me = this;
                var folderName, description;
                var attr = {};
                switch (exname) {
                    case 'differential-signaling':
                        folderName = 'Differential signaling study: Er Pos Vs Neg';
                        execution = "differential-signaling";
                        description = "Differential signaling study using data with 2 conditions: The oestrogen receptor (ER -) negative group Vs positive group (ER %2B ), each group has 178 samples";
                        options = {
                            "output_folder": {
                                out: true,
                            },
                            "verbose": {
                                type: 'flag'
                            },
                            "species": {
                                "type": "text",
                                "value": "hsa"
                            },
                            "design_type": {
                                "type": "text",
                                "value": "categorical"
                            },
                            "exp_file": {
                                "type": "file",
                                "mode": "example",
                                "value": "brca_data_example_ERposneg.tsv"
                            },
                            "design_file": {
                                "type": "file",
                                "mode": "example",
                                "value": "brca_designmatrix_ERposneg.tsv"
                            },
                            "cond1": {
                                "type": "text",
                                "value": "Negative"
                            },
                            "cond2": {
                                "type": "text",
                                "value": "Positive"
                            },
                            "difexp": {
                                "type": "flag"
                            },
                            "go": {
                                "type": "flag"
                            },
                            "uniprot": {
                                "type": "flag"
                            },
                            "pathways_list": {
                                "type": "text",
                                "value": "04014,04015,04010,04012,04310,04330,04340,04350,04390,04370,04630,04064,04668,04066,04068,04020,04071,04024,04022,04151,04152,04150,04110,04114,04210,04115,04510,04520,04530,04540,04611,04620,04621,04622,04650,04660,04662,04664,04666,04670,04062,04910,04922,04920,03320,04912,04915,04914,04921,04919,04916,04261,04270,04722,05200,05231,05202,05205"
                            }
                        };
                        break;
                    case 'prediction-train':
                        folderName = 'Prediction_train_BRCA-LumB-vs-LumA';
                        execution = "prediction-train";
                        description= "Build new predictor using the Breast Cancer dataset of 2 classes LumB vs LumA";
                        options = {
                            "output_folder": {
                                out: true,
                            },
                            "verbose": {
                                type: 'flag'
                            },
                            "species": {
                                "type": "text",
                                "value": "hsa"
                            },
                            "design_type": {
                                "type": "text",
                                "value": "categorical"
                            },
                            "exp_file": {
                                "type": "file",
                                "mode": "example",
                                "value": "brca_sub_class/brca_sub_class_exp_train.txt"
                            },
                            "design_file": {
                                "type": "file",
                                "mode": "example",
                                "value": "brca_sub_class/brca_sub_class_des_train.txt"
                            },
                            "cond1": {
                                "type": "text",
                                "value": "LumB"
                            },
                            "cond2": {
                                "type": "text",
                                "value": "LumA"
                            },
                            "filter_paths":{
                                type: 'flag'
                            },
                            "pathways_list": {
                                "type": "text",
                                "value": "04014,04015,04010,04012,04310,04330,04340,04350,04390,04370,04630,04064,04668,04066,04068,04020,04071,04024,04022,04151,04152,04150,04110,04114,04210,04115,04510,04520,04530,04540,04611,04620,04621,04622,04650,04660,04662,04664,04666,04670,04062,04910,04922,04920,03320,04912,04915,04914,04921,04919,04916,04261,04270,04722,05200,05231,05202,05205"
                            }
                        };
                        break;
                    case 'prediction-test':
                        folderName = 'Prediction_test_BRCA-LumB-vs-LumA';
                        execution = "prediction-test";
                        description= "Use existing predictor in order to predict the LumB (BRCA data)";
                        options = {
                            "output_folder": {
                                out: true,
                            },
                            "verbose": {
                                type: 'flag'
                            },
                            "exp_file": {
                                "type": "file",
                                "mode": "example",
                                "value": "brca_sub_class/brca_sub_class_exp_test.txt"
                            },
                            "model_file": {
                                "type": "file",
                                "mode": "example",
                                "value": "Prediction_train_BRCA-LumB-vs-LumA/model.RData"
                            }
                        };
                        break;
                    case 'perturbation-effect':
                        folderName = 'PAAD__Perturbation_effect_study-PAAD-TCGA_counts';
                        execution = "perturbation-effect";
                        description= "This is an example of a perturbation study using the Erlotinib drug  (EGFR) and simulating the KO the raf1 gene.";
                        geneList = [{
                            "name": "EGFR", 
                            "value": 0, 
                            "manual": true, 
                            "drugactions": [{
                                "action": "antagonist",
                                "drug": "Erlotinib",
                                "drugid": "DB00530",
                                "drugvalue": 0.1}]
                            },{
                            "name": "RAF1", 
                            "value": "0", 
                            "manual": true
                        }];
                        drugList = [];
                        relatedDrugList = [
                            {i: "DB00002", s: null},
                            {i: "DB00072", s: null},
                            {i: "DB00281", s: null},
                            {i: "DB00317", s: null},
                            {i: "DB00530", s: true},
                            {i: "DB01259", s: null},
                            {i: "DB01269", s: null},
                            {i: "DB03496", s: null},
                            {i: "DB04988", s: null},
                            {i: "DB05101", s: null},
                            {i: "DB05294", s: null},
                            {i: "DB05324", s: null},
                            {i: "DB05374", s: null},
                            {i: "DB05424", s: null},
                            {i: "DB05774", s: null},
                            {i: "DB05900", s: null},
                            {i: "DB07602", s: null},
                            {i: "DB07662", s: null},
                            {i: "DB08916", s: null},
                            {i: "DB00398", s: null},
                            {i: "DB04973", s: null},
                            {i: "DB05190", s: null},
                            {i: "DB05268", s: null},
                            {i: "DB08896", s: null},
                            {i: "DB08912", s: null}
                        ];
                        attr.geneList = geneList;
                        attr.drugList = drugList;
                        attr.relatedDrugList = relatedDrugList;
                        options = {
                            "sample" : {
                                "value" : "TCGA.IB.AAUS.01A.12R.A38C.07",
                                "type" : "text"
                            },
                            "working_folder": {
                                out: true,
                            },
                            "verbose": {
                                type: 'flag'
                            },
                            "exp_file": {
                                type: 'file',
                                mode: 'example',
                                value: "PAAD-TCGA_counts_log2TMM_Tumor.tsv",
                            },
                            "log": {
                                "type": "flag"
                            },
                            "reportXMLattributes": {
                                "pathwayDrugViewer": attr
                            }
                        };
                        break;
                    case 'variant-interpreter':
                        folderName = 'Variant_Functional_Interpreter_study__RAP1GAP';
                        execution = "variant-interpreter";
                        description= "Using the 54 control samples of diabetes with a KO of RAP1GAP";
                        options = {
                            "output_folder": {
                                out: true,
                            },
                            "verbose": {
                                type: 'flag'
                            },
                            "species": {
                                "type": "text",
                                "value": "hsa"
                            },
                            "design_type": {
                                "type": "text",
                                "value": "categorical"
                            },
                            "difexp": {
                                "type": "flag"
                            },
                            "pathways_list": {
                                "type": "text",
                                "value": "04015"
                            },
                            "TissueList": {
                                "type": "text",
                                "value": "custom"
                            },
                            "exp_file": {
                                "type": "file",
                                "mode": "example",
                                "value": "exp_data_onlyControls.tsv"
                            },
                            "custom": {
                                "type": "flag"
                            },
                            "Tissue": {
                                "type": "text",
                                "value": "custom"
                            },
                            "variant_file" :{
                                "type": "file",
                                "mode": "example",
                                "value": "RAP1GAP.tsv"
                            }
                        };
                        break;
                }
                CbaManager.jobs.example({
                    query: {
                        folderName: folderName,
                        tool: 'hipathia',
                        execution: execution,
                        description: description,
                        options: JSON.stringify(options)
                    },
                    request: {
                        method: 'GET',
                        success: function(response) {
                            //console.log("the folder id is :"+ response.response[0].results[0].out);
                            me.$.jobBrowserPanel.show();
                            /*if(exname== 'perturbation-effect'){
                                reportFolder_id = response.response[0].results[0].out;
                                CbaManager.getPlainFolderFiles(reportFolder_id, function(files) {
                                    console.log(files);
                                    for (var key in files) {
                                        if (files[key].name == "report.xml" ){ 
                                            var reportFile_id = files[key]._id;
                                        }
                                    }
                                    CbaManager.updateFileAttributes(reportFile_id, {
                                        pathwayDrugViewer: attr
                                    }, function() {});
                                });
                            }*/
                        },
                        error: function(response) {

                        }
                    }
                });
            },
            //Path act Functions
            loadDrugActions: function() {
                var me = this;
                this._openRemoteFile('./conf/drug-actions.json', function(content) {
                    var allActions = JSON.parse(content);
                    var nameMap = {};
                    var actions = [];
                    var actionsMap = {};
                    for (var i = 0; i < allActions.length; i++) {
                        var a = allActions[i];
                        var n = a.name.toLowerCase();
                        if (nameMap[n] !== true) {
                            nameMap[n] = true;
                            var obj = {
                                name: a.name,
                                value: a.value
                            };
                            actions.push(obj);
                            actionsMap[n] = obj;
                        }
                    }
                    me.set('drugActionList', actions);
                    me.set('drugActionMap', actionsMap);
                    localStorage.setItem("pathact_actions", JSON.stringify(actions));
                    localStorage.setItem("pathact_actionsmap", JSON.stringify(actionsMap));
                });
            },
            _openRemoteFile: function(filepath, cb) {
                var me = this;
                var request = new XMLHttpRequest();
                request.onload = function() {
                    cb(this.responseText);
                };
                request.onerror = function() {
                    console.log('Error loading remote file');
                };
                request.open("GET", filepath);
                request.send();
            },
            handleFoldChange: function() {
                var fc = localStorage.setItem("pathact_foldchange", this.$.foldChangeInput.value);
                this.set('foldChange', this.$.foldChangeInput.value);
            },
            handleActionWeightChange: function() {
                localStorage.setItem("pathact_actions", JSON.stringify(this.drugActionList));
                var actionsMap = {};
                for (var i = 0; i < this.drugActionList.length; i++) {
                    var a = this.drugActionList[i];
                    actionsMap[a.name] = a;
                }
                localStorage.setItem("pathact_actionsmap", JSON.stringify(actionsMap));
                this.set('drugActionMap', actionsMap);
                this.$.viewer.$.geneSearch._processDrugRelatedGenes();
            },
            handleJobClearAll: function(e) {
                this.$.reportP.set('job', null);
                this.$.report.set('job', null); 
                this.$.viewer.reset();
                this.$.vafiViewer.reset();
                while (this.$.report.$.main.firstChild) {
                        this.$.report.$.main.removeChild(this.$.report.$.main.firstChild);
                    }
            },
            handleJobClear: function(e) {
                this._loadReport();
            },
            handleJobUpdate: function(e) {
                this._loadReport();
            },
            _loadReport: function(job) {
                this.$.reportP.set('job', null);
                this.$.reportP.set('job', this.jobItem);
            },
            _loadVafiReport: function(job) {
            },
            handleCloseReport: function() {
                this.$.reportPanel.hide();
            },
            handleReportButton: function(e) {
                var me = this;
                this.$.reportPanel.show();
            },
            handleCloseJobResult: function(e) {
                this.set('selectedOption', 'home');
            }

        });
    </script>
</dom-module>
